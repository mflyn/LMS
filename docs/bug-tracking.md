# Bug 跟踪文档

## 功能改进记录

### 改进 #001: 增加手机号注册功能

**日期**: 2024-12-19  
**类型**: 功能增强  
**优先级**: 中等  

#### 问题描述
当前系统只支持邮箱注册，限制了用户的注册方式选择。特别是对于移动端用户和家长用户，手机号注册更加便捷。

#### 解决方案
1. **数据模型更新**:
   - 修改User模型，将email字段改为可选
   - 添加phone字段支持手机号
   - 添加registrationType字段标识注册方式
   - 添加验证逻辑确保至少提供邮箱或手机号之一

2. **后端API更新**:
   - 更新注册验证规则，支持邮箱、手机号或混合注册
   - 添加邮箱或手机号登录接口
   - 更新认证控制器支持多种登录方式

3. **前端界面更新**:
   - 创建新的注册页面，支持三种注册方式选择
   - 更新登录页面，支持用户名或邮箱/手机号登录
   - 更新AuthContext支持新的登录方式

#### 修改文件列表
- `backend/common/models/User.js` - 用户模型更新
- `backend/common/middleware/requestValidator.js` - 验证规则更新
- `backend/services/auth-service/controllers/authController.js` - 认证控制器更新
- `backend/services/auth-service/routes/auth.js` - 路由更新
- `frontend/web/src/pages/Register.js` - 新建注册页面
- `frontend/web/src/pages/Login.js` - 登录页面更新
- `frontend/web/src/contexts/AuthContext.js` - 认证上下文更新
- `frontend/web/src/App.js` - 路由配置更新
- `docs/设计文档.md` - 设计文档更新

#### 测试要点
1. **注册功能测试**:
   - [ ] 邮箱注册功能正常
   - [ ] 手机号注册功能正常
   - [ ] 混合注册功能正常
   - [ ] 重复邮箱/手机号验证
   - [ ] 输入格式验证

2. **登录功能测试**:
   - [ ] 用户名登录功能正常
   - [ ] 邮箱登录功能正常
   - [ ] 手机号登录功能正常
   - [ ] 错误信息提示正确

3. **数据完整性测试**:
   - [ ] 用户数据正确保存
   - [ ] 注册类型正确标识
   - [ ] 索引正常工作

#### 状态
- [x] 设计文档更新
- [x] 后端模型更新
- [x] 后端API实现
- [x] 前端界面实现
- [ ] 单元测试
- [ ] 集成测试
- [ ] 用户验收测试

#### 备注
- 当前实现为基础版本，未包含邮箱/手机号验证功能
- 后续可考虑添加短信验证码和邮箱验证功能
- 需要更新相关测试用例以覆盖新功能 